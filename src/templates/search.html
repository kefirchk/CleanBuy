{% extends "base.html" %}

{% block head %}
<script>
    const searchForUser = () => {
        const searchInputValue = document.getElementById("user_search").value;
        window.location.href = `/pages/search/?username=${searchInputValue}`;
    }

    window.onload = () => {
        const searchInput = document.getElementById("user_search");
        searchInput.addEventListener("keydown", function(event) {
            if (event.key === "Enter") {
                event.preventDefault();
                searchForUser();
            }
        });

        const messageButtons = document.querySelectorAll(".write-message-btn");
        messageButtons.forEach(button => {
            button.addEventListener("click", function() {
                const username = this.getAttribute("data-username");
                const chatContainer = document.getElementById("chat_container");
                chatContainer.innerHTML = `
                    <h2 class="text-xl font-bold mb-4">Chat with ${username}</h2>
                    <div class="bg-gray-100 p-4 rounded-lg mb-4">
                        <p class="text-sm text-gray-700">This is the beginning of your conversation with ${username}.</p>
                    </div>
                    <textarea class="w-full p-2 border-2 border-gray-300 rounded-lg mb-2" placeholder="Write a message..."></textarea>
                    <button class="bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600 transition">Send</button>
                `;
            });
        });
    };
</script>

<style>
    .flex-container {
        display: flex;
        height: 100vh;
    }
    .search-section {
        width: 35%;
        border-right: 1px solid #ddd;
        padding: 20px;
        overflow-y: auto;
    }
    .chat-section {
        width: 65%;
        padding: 20px;
    }
</style>
{% endblock %}

{% block content %}
<div class="flex-container">
    <!-- Левая колонка с поиском -->
    <div class="search-section">
        <div class="flex gap-5 mb-5">
            <input id="user_search" type="text" placeholder="Username" class="text-xl p-2 border-2 border-gray-300 rounded-lg w-full">
            <button onclick="searchForUser()" class="border-2 rounded-3xl bg-blue-500 text-white p-3 transition hover:bg-blue-600">
                Search
            </button>
        </div>
        <span class="text-gray-600">E.g. Bob, Alice, etc.</span>
        {% for user in users %}
            <div class="flex flex-col md:flex-row rounded-lg border-2 border-gray-300 p-5 mt-5 bg-white shadow-md">
                <img src="{{ url_for('static', path='user.png') }}" alt="User image" class="mr-5 rounded-lg w-24 h-24 object-cover">
                <div class="flex flex-col justify-between">
                    <div>
                        <span class="text-2xl font-bold">{{ user.username }}</span>
                        <span class="text-lg text-gray-500">{{ user.email }}</span>
                    </div>
                    <span class="text-sm text-gray-500 bg-gray-100 px-2 py-1 rounded-lg shadow mt-2">
                        {{ user.role }}
                    </span>
                    <div class="text-gray-700 mt-3 flex flex-col gap-2">
                        {% if user.buyer_information %}
                            <span><strong>Location:</strong> {{ user.buyer_information.location.city }}, {{ user.buyer_information.location.country }}</span>
                            <span><strong>Import countries:</strong>
                                {% for country in user.buyer_information.import_countries %}
                                    {{ country }}{% if not loop.last %}, {% endif %}
                                {% endfor %}
                            </span>
                            <span><strong>Product segment:</strong> {{ user.buyer_information.product_segment.value }}</span>
                            <span><strong>Commission rate:</strong> from {{ user.buyer_information.commission_rate.min_rate }}% to {{ user.buyer_information.commission_rate.max_rate }}%</span>
                            <span><strong>Price range:</strong> from ${{ user.buyer_information.price_range.min_price }} to ${{ user.buyer_information.price_range.max_price }}</span>
                            <span><strong>Delivery:</strong> {{ user.buyer_information.delivery_options.value }}</span>
                            <span><strong>Payment:</strong>
                                {% for p_option in user.buyer_information.payment_options %}
                                    {{ p_option.value }}{% if not loop.last %}, {% endif %}
                                {% endfor %}
                            </span>
                            <span><strong>Prepayment percentage:</strong> {{ user.buyer_information.prepayment_percentage }}%</span>
                        {% endif %}
                    </div>
                    <button data-username="{{ user.username }}" class="write-message-btn mt-3 bg-green-500 text-white px-4 py-2 rounded-lg hover:bg-green-600 transition">
                        Write message...
                    </button>
                </div>
            </div>
        {% endfor %}
    </div>

    <!-- Правая колонка для чата -->
    <div id="chat_container" class="chat-section">
        <p class="text-gray-500">Select a user to start a chat...</p>
    </div>
</div>
{% endblock %}
